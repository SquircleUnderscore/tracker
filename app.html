<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker</title>
    
    <!-- PWA Configuration -->
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Habits">
    <link rel="manifest" href="/manifest.json">
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="app-title">Habit Tracker</h1>
            <p class="week-label" id="weekLabel">Semaine du  au </p>
        </header>

        <main class="main-content">
            <div class="controls">
                <button class="btn btn-primary" id="createTaskBtn">+ Cr√©er une t√¢che</button>
                <div id="authSection" class="export-import-controls auth-section">
                    <span id="userEmail" class="user-email"></span>
                    <button class="btn" id="loginBtn">Se connecter</button>
                    <button class="btn" id="logoutBtn" style="display:none;">Se d√©connecter</button>
                </div>
            </div>

            <div class="week-header">
                <div class="task-name-column">T√¢ches</div>
                <div class="days-grid" id="daysGrid">
                    <div class="day-header">Lun</div>
                    <div class="day-header">Mar</div>
                    <div class="day-header">Mer</div>
                    <div class="day-header">Jeu</div>
                    <div class="day-header">Ven</div>
                    <div class="day-header">Sam</div>
                    <div class="day-header">Dim</div>
                </div>
            </div>

            <div class="tasks-container" id="tasksContainer">
            </div>

            <div class="empty-state" id="emptyState">
                <p>Aucune t√¢che pour le moment. Cr√©ez une nouvelle t√¢che pour commencer!</p>
            </div>
        </main>
    </div>

    <div class="modal" id="taskModal">
        <div class="modal-header">
            <h2>Cr√©er une nouvelle t√¢che</h2>
            <button class="modal-close" id="modalCloseBtn">√ó</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="taskName">Nom de la t√¢che</label>
                <input type="text" id="taskName" placeholder="Ex: M√©ditation, Lecture..." class="form-input">
            </div>
            <div class="form-group">
                <label for="taskIcon">Ic√¥ne</label>
                <div class="icon-grid" id="iconGrid">
                </div>
                <input type="hidden" id="selectedIcon" value="fa-star">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" id="modalCancelBtn">Annuler</button>
            <button class="btn btn-primary" id="modalCreateBtn">Cr√©er</button>
        </div>
    </div>

    <div class="modal-overlay" id="modalOverlay"></div>

    <div class="modal" id="authModal">
        <div class="modal-header">
            <h2>Connexion</h2>
            <button class="modal-close" id="authModalCloseBtn">√ó</button>
        </div>
        <div class="modal-body">
            <div class="form-group oauth-buttons">
                <button class="btn btn-primary" id="loginGithubBtn">
                    <i class="fab fa-github"></i>Continuer avec GitHub
                </button>
                <button class="btn btn-primary" id="loginGoogleBtn">
                    <i class="fab fa-google"></i>Continuer avec Google
                </button>
            </div>
            <div class="form-group">
                <label for="loginEmailInput">Ou par email</label>
                <div class="email-input-wrapper">
                    <input type="email" id="loginEmailInput" class="form-input" placeholder="francisco@respondant.com">
                    <button class="email-send-btn" id="loginEmailBtn" title="Envoyer le lien magique">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <p style="font-size:0.85rem;color:#666;margin-top:5px;text-align:right;">
                    Un lien de connexion sera envoy√© par email.
                </p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://qvixehlraqjhegazqrsu.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF2aXhlaGxyYXFqaGVnYXpxcnN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3NDYxMjksImV4cCI6MjA3OTMyMjEyOX0.IBgf1CCDy0NrjKmDRwDPRIOrOG8PNP440FXJZLswrYQ';

        if (typeof supabase === 'undefined') {
            console.error('‚ùå Supabase library not loaded!');
            console.warn('‚ö†Ô∏è Mode local uniquement - pas de synchronisation cloud');
        } else {
            console.log('‚úÖ Supabase library loaded');
            window.supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('‚úÖ Supabase client created');
        }

        // Enregistrement du Service Worker pour PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('‚úÖ Service Worker enregistr√©:', registration.scope);
                        
                        // V√©rifier les mises √† jour
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('üîÑ Nouvelle version disponible');
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.error('‚ùå Erreur enregistrement Service Worker:', error);
                    });
            });
        }
    </script>
    <script src="app.js"></script>
</body>
</html>
