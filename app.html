<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker</title>
    
    <!-- PWA Configuration -->
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Habits">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="app-title">Habit Tracker</h1>
            <div class="week-navigation">
                <button class="btn btn-week-nav" id="prevWeekBtn">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <p class="week-label" id="weekLabel">Semaine du  au </p>
                <button class="btn btn-week-nav" id="nextWeekBtn">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </header>

        <main class="main-content">
            <div class="controls">
                <button class="btn btn-primary" id="createTaskBtn">+ Créer une tâche</button>
                <div id="authSection" class="export-import-controls auth-section">
                    <span id="userEmail" class="user-email"></span>
                    <button class="btn" id="loginBtn">Se connecter</button>
                    <button class="btn" id="logoutBtn" style="display:none;">Se déconnecter</button>
                </div>
            </div>

            <div class="week-header">
                <div class="task-name-column">Tâches</div>
                <div class="days-grid" id="daysGrid">
                    <div class="day-header">Lun</div>
                    <div class="day-header">Mar</div>
                    <div class="day-header">Mer</div>
                    <div class="day-header">Jeu</div>
                    <div class="day-header">Ven</div>
                    <div class="day-header">Sam</div>
                    <div class="day-header">Dim</div>
                </div>
            </div>

            <div class="tasks-container" id="tasksContainer">
            </div>

            <div class="empty-state" id="emptyState">
                <p>Aucune tâche pour le moment. Créez une nouvelle tâche pour commencer!</p>
            </div>
        </main>
    </div>

    <div class="modal" id="taskModal">
        <div class="modal-header">
            <h2 id="taskModalTitle">Créer une nouvelle tâche</h2>
            <button class="modal-close" id="modalCloseBtn">×</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="taskName">Nom de la tâche</label>
                <input type="text" id="taskName" placeholder="Ex: Méditation, Lecture..." class="form-input">
            </div>
            <div class="form-group">
                <label for="taskIcon">Icône</label>
                <div class="icon-grid" id="iconGrid">
                </div>
                <input type="hidden" id="selectedIcon" value="fa-star">
                <input type="hidden" id="editingTaskId" value="">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" id="modalCancelBtn">Annuler</button>
            <button class="btn btn-primary" id="modalCreateBtn">Créer</button>
        </div>
    </div>

    <div class="modal-overlay" id="modalOverlay"></div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="modal" id="authModal">
        <div class="modal-header">
            <h2>Connexion</h2>
            <button class="modal-close" id="authModalCloseBtn">×</button>
        </div>
        <div class="modal-body">
            <div class="form-group oauth-buttons">
                <button class="btn btn-primary" id="loginGithubBtn">
                    <i class="fab fa-github"></i>Continuer avec GitHub
                </button>
                <button class="btn btn-primary" id="loginGoogleBtn">
                    <i class="fab fa-google"></i>Continuer avec Google
                </button>
            </div>
            <div class="form-group">
                <label for="loginEmailInput">Ou par email</label>
                <div class="email-input-wrapper">
                    <input type="email" id="loginEmailInput" class="form-input" placeholder="francisco@respondant.com">
                    <button class="email-send-btn" id="loginEmailBtn" title="Envoyer le lien magique">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <p style="font-size:0.85rem;color:#666;margin-top:5px;text-align:right;">
                    Un lien de connexion sera envoyé par email.
                </p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://qvixehlraqjhegazqrsu.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF2aXhlaGxyYXFqaGVnYXpxcnN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3NDYxMjksImV4cCI6MjA3OTMyMjEyOX0.IBgf1CCDy0NrjKmDRwDPRIOrOG8PNP440FXJZLswrYQ';

        if (typeof supabase !== 'undefined') {
            window.supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        }

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                }
                            });
                        });
                    })
                    .catch(() => {});
            });
        }
    </script>
    <script src="app.js"></script>
</body>
</html>
